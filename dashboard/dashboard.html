<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
</head>

<style>
     @media (min-width: 310px) {
 
.scroll-wi {
    width: 290px; 
    overflow-x: auto; 
    white-space: nowrap; 
}


#categoryList {
    display: flex;
    gap: 10px; 
    overflow-x: auto; 
    white-space: nowrap; 
    padding-bottom: 5px; 
}


#categoryList::-webkit-scrollbar {
    width: 6px; /* Thin scrollbar */
    height: 2px;
}


#categoryList::-webkit-scrollbar-track {
    background: rgb(143, 143, 253); 
}

#categoryList::-webkit-scrollbar-thumb {
    background: rgb(143, 143, 253); 
    border-radius: 10px;
}



     }
    @media (min-width: 768px) {
        .scroll-wi{
      width: 900px;
    }
    #categoryList::-webkit-scrollbar {
        display: none; /* Fully hide scrollbar */
    }
    #categoryList::-webkit-scrollbar-track {
        background: transparent; /* Transparent track */
    }
    #categoryList::-webkit-scrollbar-thumb {
        background: transparent; /* Transparent thumb */
    }
    }
</style>



<body>
    
    <div id="categoryList" class="flex text-xs scroll-wi mx-2 mx-auto my-2 gap-3">
        <a href="dashboardpage.html">
            <button class='bg-pink-200 p-2 sm:w-28 w-32 rounded flex items-center gap-2 font-bold text-sm text-pink-700 justify-center'>
                <img src="../dashboard/image/Vector (4).png" alt="logo" class="h-4 w-4"/>
                <p>Profile</p>
                
            </button>
        </a>
        <a href="cartpage.html">
            <button class='bg-pink-200 p-2 w-36 rounded flex items-center gap-2 font-bold text-sm text-pink-700 justify-center'>
                <img src="../dashboard/image/Vector (4).png" alt="Wishlist" class='h-4 w-4'> 
                <p>My Wishlist</p>
            </button>
        </a>
        <a href="orderpage.html" class="hidden sm:block">
            <button class='bg-pink-200 p-2 w-40 rounded flex items-center gap-2 font-bold text-sm text-pink-700 justify-center'>
                <img src="../dashboard/image/Vector (5).png" alt="Order History" class='h-4 w-4'> 
                <p>Order History</p>
            </button>
        </a>
        <a href="contactpage.html">
            <button class='bg-pink-200 p-2 sm:w-36 w-40 rounded flex items-center gap-2 font-bold text-sm text-pink-700 justify-center'>
                <img src="../dashboard/image/Vector (6).png" alt="Help Center" class='h-4 w-4'> 
                <p>Help Center</p>
            </button>
        </a>
        <button id="logoutButton"  onclick="logout()" class='bg-pink-200 py-2 px-6 sm:px-2 w-40 rounded flex items-center gap-2 font-bold text-sm text-pink-700 justify-center'>
            <img src="../dashboard/image/Vector (7).png" alt="Logout" class='h-4 w-4'> 
            <p>Log Out</p>
        </button>
    </div>
    
    <div class="mb-10 flex gap-4 flex-wrap justify-center">
        <div class="flex justify-center  mt-10 max-w-sm w-96 bg-blue-200 p-4 flex-col items-center" style="background-image: url('../dashboard/image/Untitled\ design\ \(10\)\ 2.png');">
            <div class="profile flex flex-col justify-center items-center" >
                <img id="profile-img" class="rounded-full w-40 h-40" alt="Profile Picture" />
                <!-- <a href="../editprofileuser.html" class="text-black mt-4 font-bold text-sm hover:text-blue-500 cursor-pointer">Edit</a> -->
                <h2 class="text-xl my-2 font-bold" id="user-name">Loading...</h2>
                <p class="text-sm mb-2 font-bold">Email: <span id="email">Loading...</span></p>
                <p class="text-sm mb-2 font-bold">Phone: <span id="phone">Loading...</span></p>
            </div>
                
        </div>
        
        <div class="flex flex-col gap-2">
            <a href="notificationpage.html">
                <div class="bg-green-100 sm:w-80 w-72 rounded p-4 border border-blue-200">
                    <div class="inline-flex items-center gap-3">
                        <img src="../dashboard/image/Vector (9).png" alt="Notification" class='h-4 w-3'>
                        <p class="font-bold text-sm">Settings</p>
                    </div>
                    <p class="text-sm font-bold my-2">Notification</p>
                    <p class="text-xs w-64">We send SMS messages for booking-related notifications. Select the notifications you want to receive.</p>
                </div>
            </a>
            <div class="bg-green-100 sm:w-80 w-72 rounded px-4 py-2 border border-blue-200">
                <div class="inline-flex items-center gap-3">
                    <img src="../dashboard/image/Pets--Streamline-Rounded-Material 1.png" alt="Pets" class='h-4 w-3'>
                    <p class="font-bold text-sm">Pets</p>
                </div>
                <p class="text-sm my-2 font-bold">Tell Us About Your Pets</p>
                <p class="text-xs w-64 sm:w-72">Share details about your pets to help us provide the perfect rental experience. Add them one by one to ensure we understand their unique needs.</p>
                <a href='shoppage.html'><p class="text-pink-700 text-sm">View Pets</p></a>
            </div>
            <div class="bg-green-100 sm:w-80 w-72 rounded px-4 py-2 border border-blue-200">
                <a href="paymentpage.html">
                    <div class="inline-flex items-center gap-3">
                        <img src="../dashboard/image/Vector (8).png" alt="Payment" class='h-4 w-3'>
                        <p class="font-bold text-sm">Payment Methods</p>
                    </div>
                    <p class="text-xs w-64">We offer secure and convenient payment options for a hassle-free experience.</p>
                    <div class="mt-4 mb-2 flex justify-around">
                        <img src="../dashboard/image/Frame 144.png" alt="Payment1" class='h-8 w-16'>
                        <img src="../dashboard/image/download (3) 1.png" alt="Payment2" class='h-6 w-16'>
                        <img src="../dashboard/image/Frame 146.png" alt="Payment3" class='h-6 w-16'>
                    </div>
                </a>
            </div>
        </div>
    </div>

   <script>
   document.addEventListener("DOMContentLoaded", function () {
    console.log("Loading user profile...");
    loadUserProfileFromLocalStorage();
    fetchUserProfile();
});

function loadUserProfileFromLocalStorage() {
    console.log("Fetching user profile from localStorage...");

    let userProfileImage = localStorage.getItem("user_profile_image") || "default.jpg";
    let userFirstName = localStorage.getItem("user_firstname") || "Guest";
    let userLastName = localStorage.getItem("user_lastname") || "";
    let userEmail = localStorage.getItem("user_email") || "";
    let userPhone = localStorage.getItem("user_phone") || "N/A";

    console.log("LocalStorage Data Retrieved:", {
        userProfileImage,
        userFirstName,
        userLastName,
        userEmail,
        userPhone
    });

    updateProfileUI(userProfileImage, `${userFirstName} ${userLastName}`, userEmail, userPhone);
}

async function fetchUserProfile() {
    try {
        console.log("Fetching user profile from API...");

        let response = await fetch("http://localhost/mywebsite/function/user_profile.php", {
            credentials: "include",
        });

        let data = await response.json();
        console.log("API Response:", data);

        if (!data.success || !data.user) {
            console.error("Error fetching profile:", data.error);
            alert(data.error || "Failed to load profile.");
            window.location.href = "../login.html";
            return;
        }

        console.log("Fetched User Data:", data.user);

        // Construct the correct image URL
        let imageUrl = data.user.profile_image.startsWith("http")
            ? data.user.profile_image
            : `http://localhost/mywebsite/uploads/${data.user.profile_image}`;

        updateProfileUI(imageUrl, `${data.user.firstname} ${data.user.lastname}`, data.user.email, data.user.phone);

        // Store in localStorage for future use
        localStorage.setItem("user_profile_image", imageUrl);
        localStorage.setItem("user_firstname", data.user.firstname);
        localStorage.setItem("user_lastname", data.user.lastname);
        localStorage.setItem("user_email", data.user.email);
        localStorage.setItem("user_phone", data.user.phone);

        console.log("User profile updated in localStorage.");
    } catch (error) {
        console.error("Error fetching profile:", error);
    }
}

function updateProfileUI(image, name, email, phone) {
    let profileImg = document.getElementById("profile-img");

    if (!profileImg) {
        console.error("Error: profile-img element not found in DOM.");
        return;
    }

    console.log("Setting Profile Image Source:", image);
    profileImg.src = image;

    let userName = document.getElementById("user-name");
    let userEmail = document.getElementById("email");
    let userPhone = document.getElementById("phone");

    if (userName) userName.textContent = name;
    if (userEmail) userEmail.textContent = email;
    if (userPhone) userPhone.textContent = phone;
}


function logout() {
    console.log("Logging out...");

    const logoutButton = document.getElementById("logoutButton");
    logoutButton.innerHTML = "Logging out...";
    logoutButton.disabled = true;

    fetch("http://localhost/mywebsite/function/user_profile.php?logout=true")
        .then(response => response.text()) // âœ… Get raw text first
        .then(text => {
            console.log("Raw Logout Response:", text);

            try {
                return JSON.parse(text); // âœ… Try parsing as JSON
            } catch (error) {
                throw new Error("Invalid JSON response: " + text);
            }
        })
        .then(data => {
            console.log("Logout Response:", data);
            if (data.success) {
                console.log("Logout successful. Redirecting to login page...");
                localStorage.clear();
                window.location.href = "../login.html";
            } else {
                throw new Error(data.error || "Logout failed");
            }
        })
        .catch(error => {
            console.error("Logout failed:", error);
            alert("Logout error: " + error.message);
        })
        .finally(() => {
            logoutButton.innerHTML = "Logout";
            logoutButton.disabled = false;
        });
}

   </script>
</body>
</html>
