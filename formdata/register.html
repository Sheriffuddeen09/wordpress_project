<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
   
</head>

<body class="flex justify-center items-center min-h-screen bg-gray-100">
    <div class="bg-white sm:px-8 pt-4 my-6 pb-8 rounded-xl border border-green-200 shadow-lg max-w-sm sm:w-full w-72 flex justify-center items-center flex-col mx-auto">
        
        <form id="register-form" enctype="multipart/form-data" class="flex flex-col mx-auto justify-center items-center">
            <h1 class="text-3xl text-center text-green-400 font-serif">
                <span class="text-black mt-2 text-center font-bold">Create Account</span>
            </h1>

            <div class="mt-4">
                <label class="block text-sm font-bold mb-2">Firstname:</label>
                <input type="text" name="firstname" id="firstname" required class="border-2 border-green-200 w-64 px-2 py-1 rounded-lg text-black outline-none" onkeyup="checkInputs()"/>

                <label class="block text-sm font-bold mt-2 mb-2">Lastname:</label>
                <input type="text" name="lastname" id="lastname" required class="border-2 border-green-200 w-64 px-2 py-1 rounded-lg text-black outline-none" onkeyup="checkInputs()"/>

                <label class="block text-sm font-bold mt-2 mb-2">Email Address:</label>
                <input type="email" name="email" id="email" required class="border-2 border-green-200 w-64 px-2 py-1 rounded-lg text-black outline-none" onkeyup="checkEmail()"/>
                <p id="email-warning" class="text-xs text-red-500 mt-1"></p>

                <label class="block text-sm font-bold mt-2 mb-2">Phone Number:</label>
                <input type="text" name="phone" id="phone" required class="border-2 border-green-200 w-64 px-2 py-1 rounded-lg text-black outline-none" onkeyup="validatePhone(this)"/>
                <p id="phone-warning" class="text-xs text-red-500 mt-1"></p>

                <label class="block text-sm font-bold mt-2 mb-2">Password:</label>
                <input type="password" name="password" id="password" required class="border-2 border-green-200 w-64 px-2 py-1 rounded-lg text-black outline-none" onkeyup="validatePassword()"/>
                <p id="password-strength" class="text-xs mt-1"></p>

                <label class="block text-sm font-bold mt-2 mb-2">Profile Image:</label>
                <input type="file" name="profile_image" id="profile_image" accept="image/*" onchange="previewFile()" class="hidden"/>
                <label for="profile_image" class="cursor-pointer w-64 bg-green-500 text-white px-4 py-2 rounded flex items-center justify-center">
                    <i class="fas fa-upload mr-2"></i> Choose File
                </label>
                <p id="file-preview" class="text-xs text-gray-500 mt-1">No file chosen</p>
                <img id="image-preview" class="mt-2 rounded-lg w-16 h-16 hidden"/>

                <button type="submit" id="register-btn" disabled class="mt-4 bg-green-500 w-64 px-2 py-2 text-sm font-bold rounded-lg text-white">Register</button>
                <p id="response-message" class="text-xs mt-2"></p>
            </div>
        </form>
    </div>

     
    <script>
        // Function to check input fields categoriesFunction()
        function checkInputs() {
            let email = document.getElementById("email").value.trim();
            let password = document.getElementById("password").value.trim();
            let firstname = document.getElementById("firstname").value.trim();
            let lastname = document.getElementById("lastname").value.trim();
            let phone = document.getElementById("phone").value.trim();
            let registerBtn = document.getElementById("register-btn");
    
            registerBtn.disabled = !(email && password && firstname && lastname && phone);
        }
    
        // Function to check email
        function checkEmail() {
            let email = document.getElementById("email").value.trim();
            let emailWarning = document.getElementById("email-warning");
    
            if (email === "") {
                emailWarning.innerText = "";
                document.getElementById("register-btn").disabled = true;
                return;
            }
    
            let xhr = new XMLHttpRequest();
            xhr.open("POST", "http://localhost/mywebsite/function/register.php", true);
            xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    let response = JSON.parse(xhr.responseText);
                    if (response.exists) {
                        emailWarning.innerText = "Email already registered. Please use a different email.";
                        emailWarning.classList.add("text-red-500");
                        document.getElementById("register-btn").disabled = true;
                    } else {
                        emailWarning.innerText = "";
                        document.getElementById("register-btn").disabled = false;
                    }
                }
            };
            xhr.send("check_email=true&email=" + encodeURIComponent(email));
        }
    
        // Function to validate phone number
        function validatePhone(input) {
            let phonePattern = /^[0-9]{10,15}$/;
            let phoneWarning = document.getElementById("phone-warning");
    
            if (!phonePattern.test(input.value)) {
                phoneWarning.innerText = "Enter a valid phone number (10-15 digits)";
                input.classList.add("border-red-500");
            } else {
                phoneWarning.innerText = "";
                input.classList.remove("border-red-500");
            }
            checkInputs();
        }
    
        // Function to validate password strength
        function validatePassword() {
            let password = document.getElementById("password").value;
            let strengthText = document.getElementById("password-strength");
    
            if (password.length < 6) {
                strengthText.innerText = "Weak (at least 6 characters required)";
                strengthText.classList.add("text-red-500");
            } else {
                strengthText.innerText = "Strong";
                strengthText.classList.remove("text-red-500");
                strengthText.classList.add("text-green-500");
            }
            checkInputs();
        }
    
        // Function to preview uploaded file
        function previewFile() {
            let fileInput = document.getElementById("profile_image");
            let previewText = document.getElementById("file-preview");
            let file = fileInput.files[0];
    
            if (file) {
                let reader = new FileReader();
                reader.onload = function (e) {
                    document.getElementById("image-preview").src = e.target.result;
                    previewText.innerText = file.name;
                    document.getElementById("image-preview").classList.remove("hidden");
                };
                reader.readAsDataURL(file);
            } else {
                previewText.innerText = "No file chosen";
                document.getElementById("image-preview").classList.add("hidden");
            }
            checkInputs();
        }
    
        // Function to register user
        document.addEventListener("DOMContentLoaded", function () {
            let registerForm = document.getElementById("register-form");
    
            registerForm.addEventListener("submit", async function (event) {
                event.preventDefault(); // Stop form submission
                console.log("Form submission prevented"); // Debugging
    
                let formData = new FormData(registerForm);
                let fileInput = document.getElementById("profile_image");
    
                if (fileInput.files.length > 0) {
                    formData.append("profile_image", fileInput.files[0]);
                }
    
                let registerBtn = document.getElementById("register-btn");
                let responseMessage = document.getElementById("response-message");
    
                registerBtn.innerText = "Registering...";
                registerBtn.disabled = true;
    
                try {
                    let response = await fetch("http://localhost/mywebsite/function/register.php", {
                        method: "POST",
                        body: formData
                    });
    
                    let result = await response.json();
                    console.log(result); // Debugging
    
                    if (result.success) {
                        responseMessage.innerText = "Registration successful! Redirecting...";
                        responseMessage.classList.add("text-green-500");
    
                        setTimeout(() => {
                            window.location.href = "loginpage.html";
                        }, 2000);
                    } else {
                        responseMessage.innerText = result.error || "Registration failed!";
                        responseMessage.classList.add("text-red-500");
                    }
                } catch (error) {
                    console.error("Fetch error:", error);
                    responseMessage.innerText = "Error occurred. Please try again.";
                    responseMessage.classList.add("text-red-500");
                }
    
                registerBtn.innerText = "Register";
                registerBtn.disabled = false;
            });
    
            // Input field listeners
            document.getElementById("email").addEventListener("input", checkEmail);
            document.getElementById("phone").addEventListener("input", (e) => validatePhone(e.target));
            document.getElementById("password").addEventListener("input", validatePassword);
            document.getElementById("profile_image").addEventListener("change", previewFile);
        });
    </script>
    
    
</body>
</html>
